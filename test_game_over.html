<!DOCTYPE html>
<html>
<head>
    <title>Game Over Screen Test</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/p5.min.js"></script>
    <script type="module">
        import { GameOverScreen } from './js/ui/GameOverScreen.js';
        import { ScoreManager } from './js/systems/ScoreManager.js';
        import { getViewportDimensions, updateGameDimensions, getSafeZoneX, getSafeZoneY, getScaleFactor, getOffsetX, getOffsetY } from './js/core/viewport.js';

        let gameOverScreen;
        let mockGame;
        let pixelFont;
        let lastTime = 0;

        window.preload = function() {
            pixelFont = loadFont('./assets/PressStart2P-Regular.ttf');
        }

        window.setup = function() {
            const { width, height } = getViewportDimensions();
            createCanvas(width, height);
            pixelDensity(1);

            mockGame = {
                scoreManager: new ScoreManager(),
                playerData: { nick: 'TestPlayer', email: 'test@example.com' },
                score: 456789, // Większy wynik do testu
                wave: 25,
                stats: {
                    totalGameTime: 1205.5
                },
                restartGame: () => console.log("Restarting game..."),
                returnToMenu: () => console.log("Returning to menu..."),
                pixelFont: pixelFont
            };

            // Dodaj przykładowe duże wyniki do testów
            // mockGame.scoreManager.saveScore({ nick: 'ProGamer', email: '' }, 987654, 50, 3600);
            // mockGame.scoreManager.saveScore({ nick: 'ElitePlayer', email: '' }, 654321, 40, 2800);
            // mockGame.scoreManager.saveScore({ nick: 'MegaMaster', email: '' }, 500000, 35, 2100);
            // mockGame.scoreManager.saveScore({ nick: 'SpeedRunner', email: '' }, 345678, 30, 1800);
            // mockGame.scoreManager.saveScore({ nick: 'TestPlayer', email: 'test@example.com' }, 456789, 25, 1205);

            updateGameDimensions(mockGame);
            gameOverScreen = new GameOverScreen(mockGame);
        }

        window.draw = function() {
            const currentTime = millis();
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            background(0);

            // Update the screen logic (handles animations and hover effects)
            const virtualMouseX = (mouseX - getOffsetX()) / getScaleFactor();
            const virtualMouseY = (mouseY - getOffsetY()) / getScaleFactor();
            gameOverScreen.update(virtualMouseX, virtualMouseY, deltaTime);

            push();
            translate(getOffsetX(), getOffsetY());
            scale(getScaleFactor());

            const topScores = mockGame.scoreManager.getTopScores(4);
            const playerRank = mockGame.scoreManager.findPlayerRank(
                mockGame.playerData,
                mockGame.score,
                Math.floor(mockGame.stats.totalGameTime)
            );

            gameOverScreen.draw(
                mockGame.score,
                mockGame.wave,
                mockGame.stats.totalGameTime,
                mockGame.playerData,
                topScores,
                playerRank
            );
            pop();
        }

        window.windowResized = function() {
            const { width, height } = getViewportDimensions();
            resizeCanvas(width, height);
            updateGameDimensions(mockGame);
        }
    </script>
</head>
<body>
</body>
</html>
